import{u as H,a as J,r as b,b as q,k as K,c as f,o as O,d as Q,e as s,f as o,w as t,t as y,h as d,n as W,q as V,s as h,E as m,P as D,i as _,T as X,U as Y}from"./index-2d38d9f5.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";const ee={class:"dashboard-container"},se={class:"dashboard-card",style:{padding:"20px","margin-bottom":"20px"}},oe={class:"mobile-hidden",style:{display:"flex","justify-content":"space-between","align-items":"center"}},ae={class:"back-icon"},te={class:"mobile-only"},le={class:"mobile-profile-header"},re={class:"profile-content"},ne={class:"dashboard-card profile-info-card",style:{padding:"30px"}},ie={class:"dashboard-card profile-stats-card",style:{padding:"30px"}},de={style:{display:"grid",gap:"16px"}},ue={class:"info-item"},me={class:"info-value"},pe={class:"info-item"},ce={class:"info-item"},fe={class:"info-value"},_e={class:"info-item"},ge={class:"info-value"},we={class:"dashboard-card",style:{padding:"30px","margin-top":"20px"}},be={class:"dashboard-card",style:{padding:"30px","margin-top":"20px"}},ye={class:"danger-actions"},ve={__name:"Profile",setup(xe){const E=H(),n=J(),N=a=>a<=0?"#f56c6c":a<=2?"#e6a23c":a<=5?"#909399":"#333",v=b(!1),x=b(!1),P=b(),w=b(),u=q({username:"",email:""}),r=q({currentPassword:"",newPassword:"",confirmPassword:""}),S={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",trigger:"blur"},{min:3,max:20,message:"ç”¨æˆ·åé•¿åº¦åœ¨3åˆ°20ä¸ªå­—ç¬¦",trigger:"blur"}],email:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±åœ°å€",trigger:"blur"},{type:"email",message:"è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€",trigger:"blur"}]},$={currentPassword:[{required:!0,message:"è¯·è¾“å…¥å½“å‰å¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç ",trigger:"blur"}],confirmPassword:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç ",trigger:"blur"},{validator:(a,e,i)=>{e!==r.newPassword?i(new Error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")):i()},trigger:"blur"}]},M=()=>{n.user&&(u.username=n.user.username,u.email=n.user.email)},A=async()=>{P.value&&await P.value.validate(async a=>{if(a){v.value=!0;try{const e=await n.updateProfile(u);e.success?m.success("ä¸ªäººä¿¡æ¯æ›´æ–°æˆåŠŸ"):m.error(e.message)}finally{v.value=!1}}})},j=async()=>{w.value&&await w.value.validate(async a=>{var e,i;if(a){x.value=!0;try{await h.put("/users/change-password",{current_password:r.currentPassword,new_password:r.newPassword}),m.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),k()}catch(p){m.error(((i=(e=p.response)==null?void 0:e.data)==null?void 0:i.detail)||"å¯†ç ä¿®æ”¹å¤±è´¥")}finally{x.value=!1}}})},k=()=>{var a;r.currentPassword="",r.newPassword="",r.confirmPassword="",(a=w.value)==null||a.clearValidate()},I=async()=>{try{await V.confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ¸¸è®°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼","ç¡®è®¤æ¸…ç©º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await h.delete("/travel-notes/all"),m.success("æ‰€æœ‰æ¸¸è®°å·²æ¸…ç©º")}catch(a){a!=="cancel"&&m.error("æ¸…ç©ºå¤±è´¥")}},L=async()=>{try{await V.confirm("ç¡®å®šè¦åˆ é™¤è´¦æˆ·å—ï¼Ÿæ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰æ•°æ®ï¼Œä¸”ä¸å¯æ¢å¤ï¼","ç¡®è®¤åˆ é™¤è´¦æˆ·",{confirmButtonText:"ç¡®å®šåˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"error"}),await V.prompt("è¯·è¾“å…¥æ‚¨çš„å¯†ç ä»¥ç¡®è®¤åˆ é™¤æ“ä½œ","å¯†ç ç¡®è®¤",{confirmButtonText:"ç¡®å®šåˆ é™¤",cancelButtonText:"å–æ¶ˆ",inputType:"password",inputPlaceholder:"è¯·è¾“å…¥å¯†ç "}).then(async({value:a})=>{await h.delete("/users/me",{data:{password:a}}),m.success("è´¦æˆ·å·²åˆ é™¤"),n.logout(),E.push("/login")})}catch(a){a!=="cancel"&&m.error("åˆ é™¤å¤±è´¥")}},C=a=>a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"æœªçŸ¥";return K(()=>{M()}),(a,e)=>{var T,z,F,R,U;const i=f("el-icon"),p=f("el-input"),c=f("el-form-item"),g=f("el-button"),B=f("el-form"),G=f("el-tag");return O(),Q("div",ee,[s("div",se,[s("div",oe,[e[8]||(e[8]=s("div",{style:{flex:"1"}},[s("h1",{class:"gradient-text",style:{"font-size":"24px",margin:"0"}}," ðŸ‘¤ ä¸ªäººèµ„æ–™ "),s("p",{style:{margin:"8px 0 0 0",color:"#666"}}," ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯å’Œè®¾ç½® ")],-1)),s("div",{class:"back-button",onClick:e[0]||(e[0]=l=>a.$router.push("/dashboard"))},[s("div",ae,[o(i,{size:"18"},{default:t(()=>[o(d(D))]),_:1})]),e[7]||(e[7]=s("span",{class:"back-text"},"è¿”å›žé¦–é¡µ",-1))])]),s("div",te,[s("div",le,[e[9]||(e[9]=s("div",{class:"mobile-profile-title"},[s("h1",{class:"gradient-text",style:{"font-size":"20px",margin:"0"}}," ðŸ‘¤ ä¸ªäººèµ„æ–™ "),s("p",{style:{margin:"4px 0 0 0",color:"#666","font-size":"14px"}}," ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯å’Œè®¾ç½® ")],-1)),s("div",{class:"mobile-back-button",onClick:e[1]||(e[1]=l=>a.$router.push("/dashboard"))},[o(i,{size:"16"},{default:t(()=>[o(d(D))]),_:1})])])])]),s("div",re,[s("div",ne,[e[11]||(e[11]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"åŸºæœ¬ä¿¡æ¯",-1)),o(B,{ref_key:"profileFormRef",ref:P,model:u,rules:S,"label-width":"80px",size:"large",class:"mobile-form"},{default:t(()=>[o(c,{label:"ç”¨æˆ·å",prop:"username"},{default:t(()=>[o(p,{modelValue:u.username,"onUpdate:modelValue":e[2]||(e[2]=l=>u.username=l),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,{label:"é‚®ç®±",prop:"email"},{default:t(()=>[o(p,{modelValue:u.email,"onUpdate:modelValue":e[3]||(e[3]=l=>u.email=l),placeholder:"è¯·è¾“å…¥é‚®ç®±åœ°å€",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,null,{default:t(()=>[o(g,{type:"primary",loading:v.value,onClick:A,class:"mobile-button"},{default:t(()=>e[10]||(e[10]=[_(" ä¿å­˜ä¿®æ”¹ ")])),_:1,__:[10]},8,["loading"])]),_:1})]),_:1},8,["model"])]),s("div",ie,[e[16]||(e[16]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"è´¦æˆ·ç»Ÿè®¡",-1)),s("div",de,[s("div",ue,[e[12]||(e[12]=s("div",{class:"info-label"},"æ³¨å†Œæ—¶é—´",-1)),s("div",me,y(C((T=d(n).user)==null?void 0:T.created_at)),1)]),s("div",pe,[e[13]||(e[13]=s("div",{class:"info-label"},"å‰©ä½™ä½“éªŒæ¬¡æ•°",-1)),s("div",{class:"info-value",style:W({color:N(((z=d(n).user)==null?void 0:z.remaining_trials)||0)})},y(((F=d(n).user)==null?void 0:F.remaining_trials)||0)+" æ¬¡ ",5)]),s("div",ce,[e[14]||(e[14]=s("div",{class:"info-label"},"è´¦æˆ·ç±»åž‹",-1)),s("div",fe,[o(G,{type:(R=d(n).user)!=null&&R.is_admin?"danger":"primary"},{default:t(()=>{var l;return[_(y((l=d(n).user)!=null&&l.is_admin?"ç®¡ç†å‘˜":"æ™®é€šç”¨æˆ·"),1)]}),_:1},8,["type"])])]),s("div",_e,[e[15]||(e[15]=s("div",{class:"info-label"},"æœ€åŽç™»å½•",-1)),s("div",ge,y(C((U=d(n).user)==null?void 0:U.updated_at)),1)])])])]),s("div",we,[e[19]||(e[19]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"ä¿®æ”¹å¯†ç ",-1)),o(B,{ref_key:"passwordFormRef",ref:w,model:r,rules:$,"label-width":"120px",size:"large",style:{"max-width":"500px"},class:"mobile-form mobile-password-form"},{default:t(()=>[o(c,{label:"å½“å‰å¯†ç ",prop:"currentPassword"},{default:t(()=>[o(p,{modelValue:r.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>r.currentPassword=l),type:"password",placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç ","show-password":"",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,{label:"æ–°å¯†ç ",prop:"newPassword"},{default:t(()=>[o(p,{modelValue:r.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>r.newPassword=l),type:"password",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ","show-password":"",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,{label:"ç¡®è®¤æ–°å¯†ç ",prop:"confirmPassword"},{default:t(()=>[o(p,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>r.confirmPassword=l),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ","show-password":"",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,null,{default:t(()=>[o(g,{type:"primary",loading:x.value,onClick:j,class:"mobile-button"},{default:t(()=>e[17]||(e[17]=[_(" ä¿®æ”¹å¯†ç  ")])),_:1,__:[17]},8,["loading"]),o(g,{onClick:k,class:"mobile-button"},{default:t(()=>e[18]||(e[18]=[_("é‡ç½®")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),s("div",be,[e[22]||(e[22]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"å±é™©æ“ä½œ",-1)),s("div",ye,[o(g,{type:"warning",onClick:I,class:"mobile-button"},{default:t(()=>[o(i,null,{default:t(()=>[o(d(X))]),_:1}),e[20]||(e[20]=_(" æ¸…ç©ºæ‰€æœ‰æ¸¸è®° "))]),_:1,__:[20]}),o(g,{type:"danger",onClick:L,class:"mobile-button"},{default:t(()=>[o(i,null,{default:t(()=>[o(d(Y))]),_:1}),e[21]||(e[21]=_(" åˆ é™¤è´¦æˆ· "))]),_:1,__:[21]})])])])}}},ke=Z(ve,[["__scopeId","data-v-46796bda"]]);export{ke as default};
