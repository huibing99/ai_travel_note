import{u as H,a as J,r as b,b as q,k as K,c as f,o as O,d as Q,e as s,f as o,w as t,t as y,h as d,n as W,q as V,s as h,E as m,P as D,i as _,T as X,U as Y}from"./index-2d38d9f5.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";const ee={class:"dashboard-container"},se={class:"dashboard-card",style:{padding:"20px","margin-bottom":"20px"}},oe={class:"mobile-hidden",style:{display:"flex","justify-content":"space-between","align-items":"center"}},ae={class:"back-icon"},te={class:"mobile-only"},le={class:"mobile-profile-header"},re={class:"profile-content"},ne={class:"dashboard-card profile-info-card",style:{padding:"30px"}},ie={class:"dashboard-card profile-stats-card",style:{padding:"30px"}},de={style:{display:"grid",gap:"16px"}},ue={class:"info-item"},me={class:"info-value"},pe={class:"info-item"},ce={class:"info-item"},fe={class:"info-value"},_e={class:"info-item"},ge={class:"info-value"},we={class:"dashboard-card",style:{padding:"30px","margin-top":"20px"}},be={class:"dashboard-card",style:{padding:"30px","margin-top":"20px"}},ye={class:"danger-actions"},ve={__name:"Profile",setup(xe){const E=H(),n=J(),N=a=>a<=0?"#f56c6c":a<=2?"#e6a23c":a<=5?"#909399":"#333",v=b(!1),x=b(!1),P=b(),w=b(),u=q({username:"",email:""}),r=q({currentPassword:"",newPassword:"",confirmPassword:""}),S={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3到20个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},$={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e,i)=>{e!==r.newPassword?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]},M=()=>{n.user&&(u.username=n.user.username,u.email=n.user.email)},A=async()=>{P.value&&await P.value.validate(async a=>{if(a){v.value=!0;try{const e=await n.updateProfile(u);e.success?m.success("个人信息更新成功"):m.error(e.message)}finally{v.value=!1}}})},j=async()=>{w.value&&await w.value.validate(async a=>{var e,i;if(a){x.value=!0;try{await h.put("/users/change-password",{current_password:r.currentPassword,new_password:r.newPassword}),m.success("密码修改成功"),k()}catch(p){m.error(((i=(e=p.response)==null?void 0:e.data)==null?void 0:i.detail)||"密码修改失败")}finally{x.value=!1}}})},k=()=>{var a;r.currentPassword="",r.newPassword="",r.confirmPassword="",(a=w.value)==null||a.clearValidate()},I=async()=>{try{await V.confirm("确定要清空所有游记吗？此操作不可恢复！","确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete("/travel-notes/all"),m.success("所有游记已清空")}catch(a){a!=="cancel"&&m.error("清空失败")}},L=async()=>{try{await V.confirm("确定要删除账户吗？此操作将永久删除您的所有数据，且不可恢复！","确认删除账户",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}),await V.prompt("请输入您的密码以确认删除操作","密码确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",inputType:"password",inputPlaceholder:"请输入密码"}).then(async({value:a})=>{await h.delete("/users/me",{data:{password:a}}),m.success("账户已删除"),n.logout(),E.push("/login")})}catch(a){a!=="cancel"&&m.error("删除失败")}},C=a=>a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"未知";return K(()=>{M()}),(a,e)=>{var T,z,F,R,U;const i=f("el-icon"),p=f("el-input"),c=f("el-form-item"),g=f("el-button"),B=f("el-form"),G=f("el-tag");return O(),Q("div",ee,[s("div",se,[s("div",oe,[e[8]||(e[8]=s("div",{style:{flex:"1"}},[s("h1",{class:"gradient-text",style:{"font-size":"24px",margin:"0"}}," 👤 个人资料 "),s("p",{style:{margin:"8px 0 0 0",color:"#666"}}," 管理您的账户信息和设置 ")],-1)),s("div",{class:"back-button",onClick:e[0]||(e[0]=l=>a.$router.push("/dashboard"))},[s("div",ae,[o(i,{size:"18"},{default:t(()=>[o(d(D))]),_:1})]),e[7]||(e[7]=s("span",{class:"back-text"},"返回首页",-1))])]),s("div",te,[s("div",le,[e[9]||(e[9]=s("div",{class:"mobile-profile-title"},[s("h1",{class:"gradient-text",style:{"font-size":"20px",margin:"0"}}," 👤 个人资料 "),s("p",{style:{margin:"4px 0 0 0",color:"#666","font-size":"14px"}}," 管理您的账户信息和设置 ")],-1)),s("div",{class:"mobile-back-button",onClick:e[1]||(e[1]=l=>a.$router.push("/dashboard"))},[o(i,{size:"16"},{default:t(()=>[o(d(D))]),_:1})])])])]),s("div",re,[s("div",ne,[e[11]||(e[11]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"基本信息",-1)),o(B,{ref_key:"profileFormRef",ref:P,model:u,rules:S,"label-width":"80px",size:"large",class:"mobile-form"},{default:t(()=>[o(c,{label:"用户名",prop:"username"},{default:t(()=>[o(p,{modelValue:u.username,"onUpdate:modelValue":e[2]||(e[2]=l=>u.username=l),placeholder:"请输入用户名",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,{label:"邮箱",prop:"email"},{default:t(()=>[o(p,{modelValue:u.email,"onUpdate:modelValue":e[3]||(e[3]=l=>u.email=l),placeholder:"请输入邮箱地址",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,null,{default:t(()=>[o(g,{type:"primary",loading:v.value,onClick:A,class:"mobile-button"},{default:t(()=>e[10]||(e[10]=[_(" 保存修改 ")])),_:1,__:[10]},8,["loading"])]),_:1})]),_:1},8,["model"])]),s("div",ie,[e[16]||(e[16]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"账户统计",-1)),s("div",de,[s("div",ue,[e[12]||(e[12]=s("div",{class:"info-label"},"注册时间",-1)),s("div",me,y(C((T=d(n).user)==null?void 0:T.created_at)),1)]),s("div",pe,[e[13]||(e[13]=s("div",{class:"info-label"},"剩余体验次数",-1)),s("div",{class:"info-value",style:W({color:N(((z=d(n).user)==null?void 0:z.remaining_trials)||0)})},y(((F=d(n).user)==null?void 0:F.remaining_trials)||0)+" 次 ",5)]),s("div",ce,[e[14]||(e[14]=s("div",{class:"info-label"},"账户类型",-1)),s("div",fe,[o(G,{type:(R=d(n).user)!=null&&R.is_admin?"danger":"primary"},{default:t(()=>{var l;return[_(y((l=d(n).user)!=null&&l.is_admin?"管理员":"普通用户"),1)]}),_:1},8,["type"])])]),s("div",_e,[e[15]||(e[15]=s("div",{class:"info-label"},"最后登录",-1)),s("div",ge,y(C((U=d(n).user)==null?void 0:U.updated_at)),1)])])])]),s("div",we,[e[19]||(e[19]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"修改密码",-1)),o(B,{ref_key:"passwordFormRef",ref:w,model:r,rules:$,"label-width":"120px",size:"large",style:{"max-width":"500px"},class:"mobile-form mobile-password-form"},{default:t(()=>[o(c,{label:"当前密码",prop:"currentPassword"},{default:t(()=>[o(p,{modelValue:r.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>r.currentPassword=l),type:"password",placeholder:"请输入当前密码","show-password":"",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,{label:"新密码",prop:"newPassword"},{default:t(()=>[o(p,{modelValue:r.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>r.newPassword=l),type:"password",placeholder:"请输入新密码","show-password":"",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,{label:"确认新密码",prop:"confirmPassword"},{default:t(()=>[o(p,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>r.confirmPassword=l),type:"password",placeholder:"请再次输入新密码","show-password":"",clearable:"",class:"mobile-input"},null,8,["modelValue"])]),_:1}),o(c,null,{default:t(()=>[o(g,{type:"primary",loading:x.value,onClick:j,class:"mobile-button"},{default:t(()=>e[17]||(e[17]=[_(" 修改密码 ")])),_:1,__:[17]},8,["loading"]),o(g,{onClick:k,class:"mobile-button"},{default:t(()=>e[18]||(e[18]=[_("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),s("div",be,[e[22]||(e[22]=s("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"危险操作",-1)),s("div",ye,[o(g,{type:"warning",onClick:I,class:"mobile-button"},{default:t(()=>[o(i,null,{default:t(()=>[o(d(X))]),_:1}),e[20]||(e[20]=_(" 清空所有游记 "))]),_:1,__:[20]}),o(g,{type:"danger",onClick:L,class:"mobile-button"},{default:t(()=>[o(i,null,{default:t(()=>[o(d(Y))]),_:1}),e[21]||(e[21]=_(" 删除账户 "))]),_:1,__:[21]})])])])}}},ke=Z(ve,[["__scopeId","data-v-46796bda"]]);export{ke as default};
