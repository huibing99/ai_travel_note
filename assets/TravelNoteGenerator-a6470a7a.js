import{u as q,a as Q,r as h,j as X,v as Z,c as k,o as i,d as c,e as t,f as s,w as p,x as F,p as ee,q as S,F as U,l as $,s as V,t as M,E as y,y as te,h as _,z as le,A as ae,B as E,C as oe,D as se,G as ne,H as re}from"./index-2a54ad0e.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";const de={class:"dashboard-container"},ue={class:"dashboard-card",style:{padding:"20px","margin-bottom":"20px"}},pe={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ce={class:"back-icon"},me={class:"two-column-layout",style:{display:"grid","grid-template-columns":"1fr 1fr",gap:"20px"}},ve={class:"dashboard-card left-column",style:{padding:"30px"}},ge={class:"form-section"},fe={class:"form-section"},ye={key:2,style:{margin:"0",color:"#666"},class:"mobile-text-sm"},_e={key:3,style:{margin:"0",color:"#667eea"},class:"mobile-text-sm"},xe={key:0,class:"image-preview"},we=["src","alt"],be=["onClick"],he={class:"form-section"},ke={class:"form-section"},Ve={style:{"margin-top":"30px"}},ze={class:"button-content"},Se={class:"button-icon"},Ie={class:"button-text"},Ce={class:"main-text"},De={class:"sub-text"},Ue={class:"dashboard-card right-column",style:{padding:"30px"}},$e={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px","flex-wrap":"wrap",gap:"10px"}},Ee={key:0,class:"result-actions"},Ae={key:0,style:{"text-align":"center",padding:"60px 20px",color:"#999"}},Te={key:1,style:{"text-align":"center",padding:"60px 20px"}},Fe={key:2,class:"generate-result"},Me=["innerHTML"],Ge={__name:"TravelNoteGenerator",setup(Ne){q();const G=Q(),I=h(!1),v=h([]),g=h(!1),x=h(""),A=h(),w=h(!1),o=h({model:"gemini-2.5-flash",writingStyle:"小红书爆款风",customStyle:"",location:"",date:"",companions:"",specialExp:"",emotionKeywords:"",otherInfo:""}),N=[{label:"婕婕姐姐",value:"gemini-2.5-flash"},{label:"婕婕妹妹",value:"gemini-2.0-flash"},{label:"欧家老四",value:"gpt-4o-mini"},{label:"芊芊",value:"qwen2.5-vl-32b-instruct"},{label:"圆圆",value:"hunyuan-turbo-vision"}],Y=[{label:"小红书爆款风",value:"小红书爆款风"},{label:"鲁迅冷峻风",value:"鲁迅冷峻风"},{label:"知乎体硬核风",value:"知乎体硬核风"},{label:"文艺清新风",value:"文艺清新风"},{label:"幽默风趣风",value:"幽默风趣风"},{label:"人文考据风",value:"人文考据风"},{label:"感官沉浸风",value:"感官沉浸风"},{label:"极简主义风",value:"极简主义风"},{label:"自定义",value:"自定义"}],B=X(()=>{if(!x.value)return"";let a=x.value;return a=a.replace(/\[图(\d+)\]/g,(e,n)=>{const r=parseInt(n)-1;return r>=0&&r<v.value.length?`<img src="${v.value[r].preview}" alt="图片${n}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 16px 0; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);" />`:e}),a}),L=()=>{var a;w.value||(a=A.value)==null||a.click()},R=a=>{const e=Array.from(a.target.files);T(e)},P=a=>{if(a.preventDefault(),I.value=!1,w.value)return;const e=Array.from(a.dataTransfer.files);T(e)},T=async a=>{const e=a.filter(n=>n.type.startsWith("image/"));if(v.value.length+e.length>9){y.warning("最多只能上传9张图片");return}if(e.length===0){y.warning("请选择有效的图片文件");return}w.value=!0,y.info(`正在压缩 ${e.length} 张图片，请稍候...`);try{for(const n of e)try{const r=await K(n),u=new FileReader;u.onload=d=>{v.value.push({file:r,preview:d.target.result,name:n.name,originalSize:n.size,compressedSize:r.size})},u.readAsDataURL(r)}catch(r){console.error("图片压缩失败:",r),y.error(`图片 ${n.name} 压缩失败: ${r.message}`)}y.success(`成功压缩 ${e.length} 张图片`)}finally{w.value=!1}},K=a=>new Promise((e,n)=>{const r=document.createElement("canvas"),u=r.getContext("2d"),d=new Image;d.onload=()=>{let{width:m,height:f}=d;const l=1920;m>f?m>l&&(f=f*l/m,m=l):f>l&&(m=m*l/f,f=l),r.width=m,r.height=f,u.drawImage(d,0,0,m,f);const z=C=>{r.toBlob(D=>{if(!D){n(new Error("图片压缩失败"));return}if(D.size<=1024*1024||C<=.1){const W=new File([D],a.name,{type:D.type,lastModified:Date.now()});e(W)}else z(Math.max(.1,C-.1))},a.type==="image/png"?"image/jpeg":a.type,C)};z(.8)},d.onerror=()=>{n(new Error("图片加载失败"))};const b=new FileReader;b.onload=m=>{d.src=m.target.result},b.onerror=()=>{n(new Error("文件读取失败"))},b.readAsDataURL(a)}),H=a=>{v.value.splice(a,1)},O=async()=>{if(v.value.length===0){y.warning("请先上传图片");return}g.value=!0,x.value="";try{const a=new FormData;v.value.forEach((u,d)=>{a.append("images",u.file)}),a.append("model_selection",o.value.model),a.append("location",o.value.location),a.append("date",o.value.date),a.append("companions",o.value.companions),a.append("special_exp",o.value.specialExp),a.append("emotion_keywords",o.value.emotionKeywords),a.append("other_info",o.value.otherInfo),a.append("writing_style",o.value.writingStyle),o.value.writingStyle==="自定义"&&a.append("custom_style_input",o.value.customStyle);const e=await fetch(te("/travel-notes/generate"),{method:"POST",headers:{Authorization:`Bearer ${G.token}`},body:a});if(!e.ok){const u=await e.text();throw new Error(`生成失败: ${u}`)}const n=e.body.getReader(),r=new TextDecoder;for(;;){const{done:u,value:d}=await n.read();if(u)break;const b=r.decode(d,{stream:!0});x.value+=b}}catch(a){console.error("生成游记失败:",a),y.error("生成游记失败，请重试")}finally{g.value=!1}},j=()=>{g.value=!1,y.info("已取消生成")},J=async()=>{try{await navigator.clipboard.writeText(x.value),y.success("内容已复制到剪贴板")}catch{y.error("复制失败")}};return Z(()=>{}),(a,e)=>{const n=k("el-icon"),r=k("el-option"),u=k("el-select"),d=k("el-input"),b=k("el-col"),m=k("el-date-picker"),f=k("el-row");return i(),c("div",de,[t("div",ue,[t("div",pe,[e[14]||(e[14]=t("div",{style:{flex:"1"}},[t("h1",{class:"gradient-text",style:{"font-size":"24px",margin:"0"}}," ✨ 智能旅行游记生成器 "),t("p",{style:{margin:"8px 0 0 0",color:"#666"}}," 上传您的旅行照片，AI将为您生成精彩的旅行游记 ")],-1)),t("div",{class:"back-button",onClick:e[0]||(e[0]=l=>a.$router.push("/dashboard"))},[t("div",ce,[s(n,{size:"18"},{default:p(()=>[s(_(le))]),_:1})]),e[13]||(e[13]=t("span",{class:"back-text"},"返回首页",-1))])])]),t("div",me,[t("div",ve,[e[21]||(e[21]=t("h2",{style:{margin:"0 0 20px 0",color:"#333"}},"创作设置",-1)),t("div",ge,[e[15]||(e[15]=t("div",{class:"section-title"},"选择AI模型",-1)),s(u,{modelValue:o.value.model,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.model=l),placeholder:"请选择模型",style:{width:"100%"}},{default:p(()=>[(i(),c(U,null,$(N,l=>s(r,{key:l.value,label:l.label,value:l.value,disabled:l.disabled},null,8,["label","value","disabled"])),64))]),_:1},8,["modelValue"])]),t("div",fe,[e[17]||(e[17]=t("div",{class:"section-title"},"上传旅行照片",-1)),t("div",{class:F(["upload-area",{dragover:I.value,compressing:w.value}]),onDrop:P,onDragover:e[2]||(e[2]=ee(l=>I.value=!0,["prevent"])),onDragleave:e[3]||(e[3]=l=>I.value=!1),onClick:e[4]||(e[4]=l=>!w.value&&L())},[w.value?(i(),S(n,{key:1,size:"48",style:{color:"#667eea","margin-bottom":"16px"},class:"rotating"},{default:p(()=>[s(_(E))]),_:1})):(i(),S(n,{key:0,size:"48",style:{color:"#999","margin-bottom":"16px"}},{default:p(()=>[s(_(ae))]),_:1})),w.value?(i(),c("p",_e," 正在压缩图片，请稍候... ")):(i(),c("p",ye," 点击或拖拽上传图片 ")),e[16]||(e[16]=t("p",{style:{margin:"8px 0 0 0","font-size":"12px",color:"#999"},class:"mobile-text-xs"}," 支持 JPG、PNG、JPEG 格式，最多上传9张 ",-1))],34),t("input",{ref_key:"fileInput",ref:A,type:"file",multiple:"",accept:"image/*",style:{display:"none"},onChange:R},null,544),v.value.length>0?(i(),c("div",xe,[(i(!0),c(U,null,$(v.value,(l,z)=>(i(),c("div",{key:z,class:"image-item"},[t("img",{src:l.preview,alt:`图片${z+1}`},null,8,we),t("button",{class:"remove-btn",onClick:C=>H(z)},"×",8,be)]))),128))])):V("",!0)]),t("div",he,[e[18]||(e[18]=t("div",{class:"section-title"},"写作风格",-1)),s(u,{modelValue:o.value.writingStyle,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.writingStyle=l),placeholder:"请选择写作风格",style:{width:"100%"}},{default:p(()=>[(i(),c(U,null,$(Y,l=>s(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o.value.writingStyle==="自定义"?(i(),S(d,{key:0,modelValue:o.value.customStyle,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.customStyle=l),type:"textarea",rows:3,placeholder:"请描述您想要的写作风格...",style:{"margin-top":"12px"}},null,8,["modelValue"])):V("",!0)]),t("div",ke,[e[19]||(e[19]=t("div",{class:"section-title"},"旅行信息",-1)),s(f,{gutter:12},{default:p(()=>[s(b,{xs:24,sm:12},{default:p(()=>[s(d,{modelValue:o.value.location,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.location=l),placeholder:"地点（如：浙江省杭州市西湖景区）","prefix-icon":"Location"},null,8,["modelValue"])]),_:1}),s(b,{xs:24,sm:12},{default:p(()=>[s(m,{modelValue:o.value.date,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.date=l),type:"date",placeholder:"选择日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),s(d,{modelValue:o.value.companions,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.companions=l),placeholder:"同行者（如：家人、朋友、独行）","prefix-icon":"User",style:{"margin-top":"12px"}},null,8,["modelValue"]),s(d,{modelValue:o.value.specialExp,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.specialExp=l),type:"textarea",rows:2,placeholder:"特色体验（如：品尝西湖醋鱼、游船、看日落）",style:{"margin-top":"12px"}},null,8,["modelValue"]),s(d,{modelValue:o.value.emotionKeywords,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.emotionKeywords=l),placeholder:"情感关键词（如：悠闲、惊喜、温馨）","prefix-icon":"Star",style:{"margin-top":"12px"}},null,8,["modelValue"]),s(d,{modelValue:o.value.otherInfo,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.otherInfo=l),type:"textarea",rows:2,placeholder:"其他信息",style:{"margin-top":"12px"}},null,8,["modelValue"])]),t("div",Ve,[t("div",{class:F(["generate-button",{generating:g.value,disabled:v.value.length===0}]),onClick:O},[t("div",ze,[t("div",Se,[g.value?(i(),S(n,{key:1,size:"24",class:"rotating"},{default:p(()=>[s(_(E))]),_:1})):(i(),S(n,{key:0,size:"24"},{default:p(()=>[s(_(oe))]),_:1}))]),t("div",Ie,[t("span",Ce,M(g.value?"正在生成中...":"生成游记"),1),t("span",De,M(g.value?"AI正在为您创作精彩游记":"点击开始AI创作之旅"),1)])])],2),g.value?(i(),c("div",{key:0,class:"cancel-button",onClick:j},[s(n,{size:"16"},{default:p(()=>[s(_(se))]),_:1}),e[20]||(e[20]=t("span",null,"取消生成",-1))])):V("",!0)])]),t("div",Ue,[t("div",$e,[e[23]||(e[23]=t("h2",{style:{margin:"0",color:"#333"}},"生成结果",-1)),x.value?(i(),c("div",Ee,[t("div",{class:"action-btn copy",onClick:J},[s(n,{size:"16"},{default:p(()=>[s(_(ne))]),_:1}),e[22]||(e[22]=t("span",null,"复制",-1))])])):V("",!0)]),!x.value&&!g.value?(i(),c("div",Ae,[s(n,{size:"64"},{default:p(()=>[s(_(re))]),_:1}),e[24]||(e[24]=t("p",{style:{margin:"20px 0 0 0","font-size":"16px"},class:"mobile-text-sm"}," 上传图片并填写信息后，点击生成按钮开始创作 ",-1))])):V("",!0),g.value?(i(),c("div",Te,[s(n,{size:"64",class:"rotating"},{default:p(()=>[s(_(E))]),_:1}),e[25]||(e[25]=t("p",{style:{margin:"20px 0 0 0",color:"#666"},class:"mobile-text-sm"}," AI正在为您创作游记，请稍候... ",-1))])):V("",!0),x.value?(i(),c("div",Fe,[t("div",{class:"result-content",innerHTML:B.value},null,8,Me)])):V("",!0)])])])}}},Le=ie(Ge,[["__scopeId","data-v-0d746c1a"]]);export{Le as default};
